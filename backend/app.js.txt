require('dotenv').config();
const express = require('express');
const axios = require('axios');
const cors = require('cors');

const app = express();
app.use(cors());
app.use(express.json());

const PORT = process.env.PORT || 3001;

// ================== SYSTEM PROMPT ==================
const SYSTEM_PROMPT = `
You are PromptAdvisor, an expert prompt engineer.
Your job is to turn the user's goal into 3 clear prompts:
1) SHORT prompt (1â€“2 lines)
2) BALANCED prompt (3â€“5 lines)
3) ADVANCED prompt (5â€“8 lines with constraints)
Keep answers short and cheap to generate.
`;
// ===================================================

app.post('/api/generate', async (req, res) => {
  try {
    const { user_text, audience, tone, constraints } = req.body;

    const userMessage = `
User input: ${user_text}
Audience: ${audience || "none"}
Tone: ${tone || "none"}
Constraints: ${constraints || "none"}
`;

    const payload = {
      model: "llama3-8b-8192",   // ðŸ”¥ CHEAP + FAST MODEL
      messages: [
        { role: "system", content: SYSTEM_PROMPT },
        { role: "user", content: userMessage }
      ],
      temperature: 0.2,   // ðŸ”¥ CHEAPEST SETTING
      max_tokens: 120     // ðŸ”¥ VERY CHEAP LIMIT
    };

    const r = await axios.post(process.env.GORQ_API_URL, payload, {
      headers: {
        "Authorization": `Bearer ${process.env.GORQ_KEY}`,
        "Content-Type": "application/json"
      }
    });

    const output = r.data.choices[0].message.content;

    res.json({ success: true, data: output });

  } catch (err) {
    res.json({ success: false, error: err.message });
  }
});

app.listen(PORT, () => {
  console.log(`ðŸ”¥ Backend running on http://localhost:${PORT}`);
});
